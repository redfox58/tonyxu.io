<!DOCTYPE html>
<html lang="en-US" class="has-navbar-fixed-top">

<head>
    <meta name="generator" content="Hugo 0.56.3" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Use Firebase Cloud Function to Count Website Visitors | Tony Xu Blog</title>

     

    
    <meta name="author" content="Tony Xu"> 

    
    
    
    
    
    
    <meta itemprop="name" content="Use Firebase Cloud Function to Count Website Visitors">
<meta itemprop="description" content="It&rsquo;s getting popular to use Firebase hosting to host static website, however, you might not know you can still have server-side code hosted in Firebase for your static website, and that is the Firebase Cloud Function. Once of the case you might want to use the Cloud Function is to write something to Firebase database, for example, a hit counter. In this topic, I&rsquo;ll show you how to use Firebase Cloud Function and Firebase Realtime Database to count website visitor.">


<meta itemprop="datePublished" content="2018-08-07T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-08-07T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="447">



<meta itemprop="keywords" content="" />

    <meta property="og:title" content="Use Firebase Cloud Function to Count Website Visitors" />
<meta property="og:description" content="It&rsquo;s getting popular to use Firebase hosting to host static website, however, you might not know you can still have server-side code hosted in Firebase for your static website, and that is the Firebase Cloud Function. Once of the case you might want to use the Cloud Function is to write something to Firebase database, for example, a hit counter. In this topic, I&rsquo;ll show you how to use Firebase Cloud Function and Firebase Realtime Database to count website visitor." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tonyxu.io/posts/2018/use-firebase-cloud-function-to-count-website-visitors/" />

<meta property="og:image" content="https://tonyxu.io/images/og-image.png" />

<meta property="og:image" content="https://tonyxu.io/images/square-logo.webp" />
<meta property="article:published_time" content="2018-08-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-08-07T00:00:00+00:00" /><meta property="og:site_name" content="Tony Xu Blog" />
<meta property="og:image" content="https://tonyxu.io/images/og-image.png"/>
    
    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://tonyxu.io/images/og-image.png"/>

<meta name="twitter:title" content="Use Firebase Cloud Function to Count Website Visitors"/>
<meta name="twitter:description" content="It&rsquo;s getting popular to use Firebase hosting to host static website, however, you might not know you can still have server-side code hosted in Firebase for your static website, and that is the Firebase Cloud Function. Once of the case you might want to use the Cloud Function is to write something to Firebase database, for example, a hit counter. In this topic, I&rsquo;ll show you how to use Firebase Cloud Function and Firebase Realtime Database to count website visitor."/>

    
     
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-577792-7', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
 
    
    <link rel="canonical" href="https://tonyxu.io/posts/2018/use-firebase-cloud-function-to-count-website-visitors/"> 

     

     
    
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://tonyxu.io/images/favicons/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://tonyxu.io/images/favicons/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://tonyxu.io/images/favicons/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://tonyxu.io/images/favicons/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://tonyxu.io/images/favicons/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://tonyxu.io/images/favicons/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://tonyxu.io/images/favicons/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://tonyxu.io/images/favicons/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="https://tonyxu.io/images/favicons/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="https://tonyxu.io/images/favicons/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="https://tonyxu.io/images/favicons/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="https://tonyxu.io/images/favicons/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="https://tonyxu.io/images/favicons/favicon-128.png" sizes="128x128" />
<meta name="msapplication-TileColor" content="#3273dc" />
<meta name="msapplication-TileImage" content="https://tonyxu.io/images/favicons/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="https://tonyxu.io/images/favicons/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="https://tonyxu.io/images/favicons/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="https://tonyxu.io/images/favicons/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="https://tonyxu.io/images/favicons/mstile-310x310.png" />

    
    <link rel="stylesheet" href="/css/bulma.css"> 
    <link rel="stylesheet" href="/css/custom.css"> 
    <link rel="stylesheet" href="/css/font.css">
    <script type="text/javascript" src="/js/bulma.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
  </head>


<body>
    <header> <nav class="navbar is-fixed-top is-link">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <picture style="height:28px;">
          <source srcset="/images/square-logo.webp" type="image/webp">
          <source srcset="/images/square-logo.png" type="image/jpeg">
          <img src="/images/square-logo.png">
      </picture>
      </a>
      <a class="navbar-item" href="/">
        Tony Xu Blog
      </a>
      <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div class="navbar-menu" id="navMenu">

      
      
      <div class="navbar-end">
        
        <a class="navbar-item" target="blank" href="https://github.com/tonyxu-io">
          <span class="icon">
            <i class="icon-github"></i>
          </span>
        </a>
        

        
        <a class="navbar-item" target="blank" href="https://www.linkedin.com/in/tonyxu93">
          <span class="icon">
            <i class="icon-linkedin-square"></i>
          </span>
        </a>
        
        
        
        <a class="navbar-item" href='/search'>
          <span class="icon">
            <i class="icon-search"></i>
          </span>
        </a>
        <div class="navbar-item">
          
          <div class="field">
            <div class="control has-icons-left">
              <div class="select is-rounded is-small">
                <select size="1" name="links" onchange="window.location.href=this.value;">
                  <option selected disabled>English</option>
                  
                  <option value="/zh/posts/2018/use-firebase-cloud-function-to-count-website-visitors/">中文</option>
                  
                </select>
              </div>
              <div class="icon is-small is-left has-text-black">
                <i class="icon-language"></i>
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>

</nav> </header>
    <main>

<div class="section">
  <div class="container" itemscope itemtype="http://schema.org/BlogPosting">
    <meta itemprop="name" content="Use Firebase Cloud Function to Count Website Visitors">
<meta itemprop="description" content="It&rsquo;s getting popular to use Firebase hosting to host static website, however, you might not know you can still have server-side code hosted in Firebase for your static website, and that is the Firebase Cloud Function. Once of the case you might want to use the Cloud Function is to write something to Firebase database, for example, a hit counter. In this topic, I&rsquo;ll show you how to use Firebase Cloud Function and Firebase Realtime Database to count website visitor.">


<meta itemprop="datePublished" content="2018-08-07T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-08-07T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="447">



<meta itemprop="keywords" content="" />

    <div class="columns">
      <div class="column is-8 is-offset-2">
          <div class="columns">
              <div class="column is-8 is-offset-2 has-text-centered">
                <div class="title"><a href="/posts/">Posts</a></div>
                <p class="subtitle">My thoughts of life and code</p>
              </div>
            </div>
            <hr />
        <p class="title">Use Firebase Cloud Function to Count Website Visitors</p>
        <div class="columns is-mobile is-vcentered">
          <div class="column has-text-grey has-text-weight-semibold">
            Tony Xu<p class="text is-family-monospace has-text-grey-light">
  
08/07/2018

</p>
          </div>
          <div class="column has-text-right">
            <a class="button is-light" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftonyxu.io%2fposts%2f2018%2fuse-firebase-cloud-function-to-count-website-visitors%2f" target="_blank" title="Share to Facebook">
  <span class="icon">
      <i class="icon-facebook"></i>
  </span>
</a>
<a class="button is-light" href="https://www.linkedin.com/sharing/share-offsite?url=https%3a%2f%2ftonyxu.io%2fposts%2f2018%2fuse-firebase-cloud-function-to-count-website-visitors%2f" target="_blank"
  title="Share to LinkedIn">
  <span class="icon">
      <i class="icon-linkedin"></i>
  </span>
</a>
<a id="open-qr-code" class="button is-light" href="" title="Share with QR Code">
  <span class="icon">
      <i class="icon-qrcode"></i>
  </span>
</a>
<div class="modal">
  <div class="modal-background"></div>
  <div class="modal-content">
    <p class="image is-1by1">
      <img src="https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=https%3a%2f%2ftonyxu.io%2fposts%2f2018%2fuse-firebase-cloud-function-to-count-website-visitors%2f&choe=UTF-8" alt="">
    </p>
  </div>
  <button class="modal-close is-large" aria-label="close"></button>
</div>
<script>
  document.querySelector('a#open-qr-code').addEventListener('click', function (event) {
    event.preventDefault();
    var modal = document.querySelector('.modal');
    var html = document.querySelector('html');
    modal.classList.add('is-active');
    html.classList.add('is-clipped');

    modal.querySelector('.modal-background').addEventListener('click', function (e) {
      e.preventDefault();
      modal.classList.remove('is-active');
      html.classList.remove('is-clipped');
    });

    modal.querySelector('.modal-close').addEventListener('click', function (e) {
      e.preventDefault();
      modal.classList.remove('is-active');
      html.classList.remove('is-clipped');
    });
  });
</script>
          </div>
        </div>
        <div class="content">
          

          

<p>It&rsquo;s getting popular to use Firebase hosting to host static website, however, you might not know you can still have server-side code hosted in Firebase for your static website, and that is the Firebase Cloud Function. Once of the case you might want to use the Cloud Function is to write something to Firebase database, for example, a hit counter. In this topic, I&rsquo;ll show you how to use Firebase Cloud Function and Firebase Realtime Database to count website visitor.</p>

<h2 id="overview">Overview</h2>

<p>Here are the steps we will be doing to build this feature:</p>

<ol>
<li>Deploy static page to Firebase Cloud Hosting<br /></li>
<li>Create Firebase Cloud Function to update count number in Firebase Realtime Database<br /></li>
<li>Add Get request in static page to trigger Firebase Cloud Function<br />
<br /></li>
</ol>

<h2 id="deploy-static-page-to-firebase-cloud-hosting">Deploy static page to Firebase Cloud Hosting</h2>

<p>Firebase Cloud Hosting is a great place to host your static pages. It&rsquo;s easier to setup than GitHub Pages, and you get a set of functionalities that designed for web developers. Once you have your static pages ready, do <code>firebase deploy</code> and it will be deployed to the cloud and accessible from anywhere.</p>

<p>Refer to <a href="https://firebase.google.com/docs/hosting/quickstart" target="_blank">Quickstart</a> from documentation to get started with Firebase Cloud Hosting.</p>

<h2 id="create-firebase-cloud-function">Create Firebase Cloud Function</h2>

<p>Now, let&rsquo;s make use of Firebase Cloud Function to host some server-side logic to count website hit. In this piece of code, we will connect Cloud Function with Firebase Realtime Database so that the function can update hit counter stored in the database.</p>

<ol>
<li><p>Initialize Cloud Function</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">firebase init functions</code></pre></div></li>

<li><p>Create <code>hit_counter</code> node in Firebase Realtime Database and set value to 0</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;hit_counter&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></div></li>

<li><p>Edit Cloud Function Code (<code>Index.js</code>)</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">functions</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">require</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;firebase-functions&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">admin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">require</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;firebase-admin&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000">admin</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">initializeApp</span><span style="color:#000;font-weight:bold">();</span>
    
<span style="color:#000">exports</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">hitCounter</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">functions</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">https</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">onRequest</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">req</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">res</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">counterRef</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">admin</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">database</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">ref</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/hit_counter&#34;</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">counterRef</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#000">transaction</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">current</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">current</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">})</span>
  <span style="color:#000;font-weight:bold">});</span>
</code></pre></div></li>

<li><p>Deploy Cloud Function</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">firebase deploy</code></pre></div></li>
</ol>

<p>Now you should have a Cloud Function URL which you can make a request to. Try access it in a browser and see if the counter number in Realtime Database get incremented by 1.</p>

<h2 id="add-get-request-to-cloud-function-in-static-page">Add Get request to Cloud Function in static page</h2>

<p>Now, in order to trigger the Cloud Function to update counter in Realtime Database, you need to make the static webpage to make a request to the Cloud Function.</p>

<p>You can do it like below:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">html</span><span style="color:#000;font-weight:bold">&gt;</span>
    <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">script</span><span style="color:#000;font-weight:bold">&gt;</span>
    <span style="color:#000">fetch</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;//&lt;Region&gt;-&lt;YOUR-APP-ID&gt;.cloudfunctions.net/hitCounter&#34;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">script</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">html</span><span style="color:#000;font-weight:bold">&gt;</span></code></pre></div>
<p>This will fire a GET request to the Cloud Function endpoint, and trigger the Cloud Function code to update the counter number in Realtime Database.</p>

<p>Congratulations, your static page now has server-side code that helps you track the hit count. The next step for you could be retrieve the counter in static page and display the count number.</p>

        </div>
      </div>
    </div>
  </div>
</div>

<section class="section has-background-light">
  <div class="container">
    <div class="columns">
      <div class="column has-text-centered">
        
<p class="subtitle is-size-6-mobile">
    Subscribe to get update about programming, hacks, and other topics.
</p>

<div id="mc_embed_signup">
  <form action="https://tonyxu.us20.list-manage.com/subscribe/post?u=69c2a5fca21efd1ab71e96df7&amp;id=c90267bbd1"
    method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank"
    novalidate>
    <div id="mc_embed_signup_scroll">
      <div class="field has-addons has-addons-centered">
        <div class="control">
          <input type="email" value="" name="EMAIL" class="input required email" id="mce-EMAIL" placeholder='Email Address'></input>
        </div>
        <div class="control">
          <button type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button is-info">Subscribe</button>
        </div>
      </div>
      <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
      </div>
      
      <div style="position: absolute; left: -5000px;" aria-hidden="true">
        <input type="text" name="b_69c2a5fca21efd1ab71e96df7_c90267bbd1" tabindex="-1" value=""></input>
      </div>
    </div>
  </form>
</div>


      </div>
    </div>
</section>

<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2 has-text-centered">
        
        <article>
          <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tonyxu-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>
        
      </div>
    </div>
</section>

</main>
    <footer>
<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p class="text is-uppercase has-text-grey">
        © 2018-2019 Tony Xu
      </p>
      <p class="text">
        <a href='/about' class="has-text-grey footer-link"> About</a>
        <a href='/friends' class="has-text-grey footer-link">Friends</a>
        <a href="/index.xml" class="has-text-grey footer-link">RSS</a>
      </p>
    </div>
  </div>
</footer>
</footer>

</body>

</html>