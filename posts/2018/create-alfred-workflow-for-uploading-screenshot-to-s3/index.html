<!doctype html><html lang=en-us class=has-navbar-fixed-top><head><meta name=generator content="Hugo 0.73.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Create Alfred workflow for uploading screenshot to S3 | Tony Xu Blog</title><meta name=author content="Tony Xu"><meta itemprop=name content="Create Alfred workflow for uploading screenshot to S3"><meta itemprop=description content="As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard. Demo Overview Use pngpaste to get image data from clipboard Write to a image file in /tmp folder Use boto3 to upload image file to AWS S3 Implementation Now we have the idea"><meta itemprop=datePublished content="2018-07-08T00:00:00+00:00"><meta itemprop=dateModified content="2018-07-08T00:00:00+00:00"><meta itemprop=wordCount content="579"><meta itemprop=image content="https://tonyxu-io.pages.dev/images/og-image.png"><meta itemprop=keywords content><meta property="og:title" content="Create Alfred workflow for uploading screenshot to S3"><meta property="og:description" content="As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard. Demo Overview Use pngpaste to get image data from clipboard Write to a image file in /tmp folder Use boto3 to upload image file to AWS S3 Implementation Now we have the idea"><meta property="og:type" content="article"><meta property="og:url" content="https://tonyxu-io.pages.dev/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/"><meta property="og:image" content="https://tonyxu-io.pages.dev/images/og-image.png"><meta property="article:published_time" content="2018-07-08T00:00:00+00:00"><meta property="article:modified_time" content="2018-07-08T00:00:00+00:00"><meta property="og:site_name" content="Tony Xu Blog"><meta property="og:image" content="https://tonyxu-io.pages.dev/images/og-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tonyxu-io.pages.dev/images/og-image.png"><meta name=twitter:title content="Create Alfred workflow for uploading screenshot to S3"><meta name=twitter:description content="As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard. Demo Overview Use pngpaste to get image data from clipboard Write to a image file in /tmp folder Use boto3 to upload image file to AWS S3 Implementation Now we have the idea"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-577792-7','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=canonical href=https://tonyxu-io.pages.dev/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/><link rel=apple-touch-icon-precomposed sizes=57x57 href=https://tonyxu-io.pages.dev/images/favicons/apple-touch-icon-57x57.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=https://tonyxu-io.pages.dev/images/favicons/apple-touch-icon-114x114.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=https://tonyxu-io.pages.dev/images/favicons/apple-touch-icon-72x72.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://tonyxu-io.pages.dev/images/favicons/apple-touch-icon-144x144.png><link rel=apple-touch-icon-precomposed sizes=60x60 href=https://tonyxu-io.pages.dev/images/favicons/apple-touch-icon-60x60.png><link rel=apple-touch-icon-precomposed sizes=120x120 href=https://tonyxu-io.pages.dev/images/favicons/apple-touch-icon-120x120.png><link rel=apple-touch-icon-precomposed sizes=76x76 href=https://tonyxu-io.pages.dev/images/favicons/apple-touch-icon-76x76.png><link rel=apple-touch-icon-precomposed sizes=152x152 href=https://tonyxu-io.pages.dev/images/favicons/apple-touch-icon-152x152.png><link rel=icon type=image/png href=https://tonyxu-io.pages.dev/images/favicons/favicon-196x196.png sizes=196x196><link rel=icon type=image/png href=https://tonyxu-io.pages.dev/images/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://tonyxu-io.pages.dev/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://tonyxu-io.pages.dev/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://tonyxu-io.pages.dev/images/favicons/favicon-128.png sizes=128x128><meta name=msapplication-TileColor content="#3273dc"><meta name=msapplication-TileImage content="https://tonyxu-io.pages.dev/images/favicons/mstile-144x144.png"><meta name=msapplication-square70x70logo content="https://tonyxu-io.pages.dev/images/favicons/mstile-70x70.png"><meta name=msapplication-square150x150logo content="https://tonyxu-io.pages.dev/images/favicons/mstile-150x150.png"><meta name=msapplication-wide310x150logo content="https://tonyxu-io.pages.dev/images/favicons/mstile-310x150.png"><meta name=msapplication-square310x310logo content="https://tonyxu-io.pages.dev/images/favicons/mstile-310x310.png"><link rel=stylesheet href=https://redfox58.github.io/tonyxu.io/css/bulma.min.css><link rel=stylesheet href=https://redfox58.github.io/tonyxu.io/css/custom.css><link rel=stylesheet href=https://redfox58.github.io/tonyxu.io/css/font.css><script type=text/javascript src=https://redfox58.github.io/tonyxu.io/js/bulma.js></script><link href="https://fonts.googleapis.com/css?family=Ubuntu" rel=stylesheet></head><body><header><nav class="navbar is-fixed-top is-link"><div class=container><div class=navbar-brand><a class=navbar-item href=/><picture style=height:28px>
<source srcset=/images/square-logo.webp type=image/webp><source srcset=/images/square-logo.png type=image/jpeg><img src=/images/square-logo.png></picture></a>
<a class=navbar-item href=/>Tony Xu Blog</a>
<a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div class=navbar-menu id=navMenu><div class=navbar-end><a class=navbar-item target=blank href=https://github.com/tonyxu-io><span class=icon><i class=icon-github></i></span></a><a class=navbar-item target=blank href=https://www.linkedin.com/in/tonyxu93><span class=icon><i class=icon-linkedin-square></i></span></a><a class=navbar-item href=/search><span class=icon><i class=icon-search></i></span></a><div class=navbar-item><div class=field><div class="control has-icons-left"><div class="select is-rounded is-small"><select size=1 name=links onchange="window.location.href=this.value;">
<option selected disabled>English</option>
<option value=/zh/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/>中文</option></select></div><div class="icon is-small is-left has-text-black"><i class=icon-language></i></div></div></div></div></div></div></div></nav></header><main><div class=section><div class=container itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=name content="Create Alfred workflow for uploading screenshot to S3"><meta itemprop=description content="As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard. Demo Overview Use pngpaste to get image data from clipboard Write to a image file in /tmp folder Use boto3 to upload image file to AWS S3 Implementation Now we have the idea"><meta itemprop=datePublished content="2018-07-08T00:00:00+00:00"><meta itemprop=dateModified content="2018-07-08T00:00:00+00:00"><meta itemprop=wordCount content="579"><meta itemprop=image content="https://tonyxu-io.pages.dev/images/og-image.png"><meta itemprop=keywords content><div class=columns><div class="column is-8 is-offset-2"><div class=columns><div class="column is-8 is-offset-2 has-text-centered"><div class=title><a href=https://tonyxu-io.pages.dev/posts/>Posts</a></div><p class=subtitle>My thoughts of life and code</p></div></div><hr><p class=title>Create Alfred workflow for uploading screenshot to S3</p><div class="columns is-mobile is-vcentered"><div class=column><p class=text>Tony Xu</p><p class=text><p class=text>07/08/2018</p></p></div><div class="column has-text-right"><div class="buttons is-right py-0 mb-0"><a class="button is-light mb-0" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftonyxu-io.pages.dev%2fposts%2f2018%2fcreate-alfred-workflow-for-uploading-screenshot-to-s3%2f" target=_blank title="Share to Facebook"><span class=icon><i class=icon-facebook></i></span></a><a class="button is-light mb-0" href="https://www.linkedin.com/sharing/share-offsite?url=https%3a%2f%2ftonyxu-io.pages.dev%2fposts%2f2018%2fcreate-alfred-workflow-for-uploading-screenshot-to-s3%2f" target=_blank title="Share to LinkedIn"><span class=icon><i class=icon-linkedin></i></span></a><a id=open-qr-code class="button is-light mb-0" href title="Share with QR Code"><span class=icon><i class=icon-qrcode></i></span></a></div><div class=modal><div class=modal-background></div><div class=modal-content><p class="image is-1by1"><img src="https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=https%3a%2f%2ftonyxu-io.pages.dev%2fposts%2f2018%2fcreate-alfred-workflow-for-uploading-screenshot-to-s3%2f&choe=UTF-8" alt></p></div><button class="modal-close is-large" aria-label=close></button></div><script>document.querySelector('a#open-qr-code').addEventListener('click',function(event){event.preventDefault();var modal=document.querySelector('.modal');var html=document.querySelector('html');modal.classList.add('is-active');html.classList.add('is-clipped');modal.querySelector('.modal-background').addEventListener('click',function(e){e.preventDefault();modal.classList.remove('is-active');html.classList.remove('is-clipped');});modal.querySelector('.modal-close').addEventListener('click',function(e){e.preventDefault();modal.classList.remove('is-active');html.classList.remove('is-clipped');});});</script></div></div><div class=content><p>As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard.</p><h2 id=demo>Demo</h2><p><img src=./2018-07-08+21_33_30.gif alt=2018-07-08+21_33_30.gif></p><h2 id=overview>Overview</h2><ol><li>Use <code>pngpaste</code> to get image data from clipboard</li><li>Write to a image file in <code>/tmp</code> folder</li><li>Use <code>boto3</code> to upload image file to AWS S3</li></ol><h2 id=implementation>Implementation</h2><p>Now we have the idea to achieve the goal, let&rsquo;s do it in Alfred workflow and python script.</p><h3 id=create-alfred-workflow>Create Alfred workflow</h3><p>Create <code>Blank Workflow</code> and give it a name</p><p>Right click in background and select <code>Inputs -> Keyword</code></p><p><img src=./2018_07_08_20_56_57.png alt=2018_07_08_20_56_57.png></p><p>Give it a keyword which you will be typing to trigger the workflow</p><p><img src=./2018_07_08_20_50_57.png alt=2018_07_08_20_50_57.png></p><p>Right click in background and select <code>Actions -> Run Script</code></p><p>Let&rsquo;s make it use Python to run a script</p><p><img src=./2018_07_08_20_58_41.png alt=2018_07_08_20_58_41.png></p><p>Click on the icon on the left of <code>Cancel</code> button to open workflow folder</p><p>Create a script file (Make sure the file name is the same as the <code>Run Script</code> action uses) and edit like below</p><div class=highlight><pre style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#007f7f>#!/usr/bin/python</span>
<span style=color:#007f7f># -*- coding: utf-8 -*-</span>
<span style=color:#fff;font-weight:700>from</span> __future__ <span style=color:#fff;font-weight:700>import</span> print_function
<span style=color:#fff;font-weight:700>import</span> datetime
<span style=color:#fff;font-weight:700>import</span> os
<span style=color:#fff;font-weight:700>import</span> sys
<span style=color:#fff;font-weight:700>import</span> atexit
<span style=color:#fff;font-weight:700>import</span> imghdr
<span style=color:#fff;font-weight:700>from</span> subprocess <span style=color:#fff;font-weight:700>import</span> call
<span style=color:#fff;font-weight:700>from</span> os.path <span style=color:#fff;font-weight:700>import</span> expanduser, exists, basename, getsize
<span style=color:#fff;font-weight:700>from</span> workflow <span style=color:#fff;font-weight:700>import</span> Workflow

<span style=color:#fff;font-weight:700>def</span> capture():
    file_name = datetime.datetime.now().strftime(<span style=color:#0ff;font-weight:700>&#39;%Y_%m_</span><span style=color:#0ff;font-weight:700>%d</span><span style=color:#0ff;font-weight:700>_%H_%M_%S.png&#39;</span>)
    file_path = os.path.join(<span style=color:#0ff;font-weight:700>&#39;/tmp&#39;</span>, file_name)
    atexit.register(<span style=color:#fff;font-weight:700>lambda</span> x: os.remove(x) <span style=color:#fff;font-weight:700>if</span> os.path.exists(x) <span style=color:#fff;font-weight:700>else</span> None, file_path)
    save = call([<span style=color:#0ff;font-weight:700>&#39;./pngpaste&#39;</span>, file_path])
    <span style=color:#fff;font-weight:700>if</span> save == <span style=color:#ff0;font-weight:700>1</span>:
        <span style=color:#007f7f># Quit job if no image found in clipboard</span>
        <span style=color:#fff;font-weight:700>print</span> <span style=color:#0ff;font-weight:700>&#34;No image found in clipboard&#34;</span>
        sys.exit()
    <span style=color:#fff;font-weight:700>return</span> file_path, file_name

<span style=color:#fff;font-weight:700>def</span> main(wf):
    <span style=color:#fff;font-weight:700>import</span> boto3
    file_path, file_name = capture()
    bucket_name = os.getenv(<span style=color:#0ff;font-weight:700>&#39;bucket_name&#39;</span>)
    s3 = boto3.client(
        <span style=color:#0ff;font-weight:700>&#39;s3&#39;</span>,
        aws_access_key_id=os.getenv(<span style=color:#0ff;font-weight:700>&#39;access_key&#39;</span>),
        aws_secret_access_key=os.getenv(<span style=color:#0ff;font-weight:700>&#39;secret_key&#39;</span>)
    )
    s3.upload_file(file_path, bucket_name, file_name, ExtraArgs={<span style=color:#0ff;font-weight:700>&#39;ContentType&#39;</span>: <span style=color:#0ff;font-weight:700>&#34;image/png&#34;</span>})
    output = <span style=color:#0ff;font-weight:700>&#34;</span><span style=color:#0ff;font-weight:700>%s</span><span style=color:#0ff;font-weight:700>/</span><span style=color:#0ff;font-weight:700>%s</span><span style=color:#0ff;font-weight:700>&#34;</span> %(os.getenv(<span style=color:#0ff;font-weight:700>&#39;bucket_uri&#39;</span>), file_name)
    <span style=color:#fff;font-weight:700>print</span> (output,end=<span style=color:#0ff;font-weight:700>&#39;&#39;</span>)

<span style=color:#fff;font-weight:700>if</span> __name__ == <span style=color:#0ff;font-weight:700>&#39;__main__&#39;</span>:
    wf = Workflow(libraries=[<span style=color:#0ff;font-weight:700>&#39;./lib&#39;</span>])
    sys.exit(wf.run(main))
</code></pre></div><p>This script will return the image public url and let&rsquo;s copy it to clipboard and push a notification.</p><p>Right click on the background and select <code>Outputs –> Copy to Clipboard</code></p><p><img src=./2018_07_08_21_06_32.png alt=2018_07_08_21_06_32.png></p><p>Right click on the background and select <code>Outputs –> Post Notification</code></p><p><img src=./2018_07_08_21_06_54.png alt=2018_07_08_21_06_54.png)></p><p>Now let&rsquo;s connect those boxes like below:</p><p><img src=./2018_07_08_21_07_52.png alt=2018_07_08_21_07_52.png></p><h3 id=include-libraries>Include libraries</h3><p>In the scripts, we used below libraries and need to be included in the workflow to make sure they can be run without issue</p><ul><li><a href=http://alfredworkflow.readthedocs.io/en/latest/installation.html>Workflow</a></li><li><a href=https://docs.aws.amazon.com/cli/latest/userguide/installing.html>awscli</a></li><li><a href=https://boto3.readthedocs.io/en/latest/guide/quickstart.html#installation>boto3</a></li><li><a href=https://github.com/jcsalterego/pngpaste>pngpaste</a></li></ul><p>Install above libraries like below:</p><div class=highlight><pre style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>pip install --target=/path/to/workflow Alfred-Workflow
pip install --target=/path/to/workflow/lib awscli
pip install --target=/path/to/workflow/lib boto3
brew install pngpaste
</code></pre></div><p>Please note that pngpaste is a command line tool and you should copy the binary file to <code>/path/to/workflow</code>.</p><h3 id=add-environment-variables>Add environment variables</h3><p>In the script, we used below variables that we want to make it configurable instead of hard coded:</p><ul><li><p>access_key: S3 access key</p></li><li><p>secret_key: S3 access secret</p></li><li><p>bucket_name: S3 bucket name. e.g. <code>my-bucket-name</code></p></li><li><p>bucket_uri: S3 bucket URI without trailing slash. e.g. <code>https://s3-us-west-1.amazonaws.com/my-bucket-name</code></p></li></ul><p>Add and config above environment variables into workflow environment variables settings like below</p><p><img src=./2018_07_10_20_55_19.png alt=2018_07_10_20_55_19.png></p><p>Follow instructions <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_CreateAccessKey>here</a> to create access key and secret if you don&rsquo;t have it already</p><p>Make sure the user can read/write to S3 bucket.</p><h2 id=complete>Complete</h2><p>Congratulations You made it! Give it a try!</p><h2 id=follow-up>Follow-up</h2><p>Now you may think of adding support for the workflow to be able to upload any image from local. As you are getting familiar with Alfred workflow development, feel free to give it a try!</p><p>Download in Github:</p><p><a href=https://github.com/tonyxu-io/Alfred-Workflow-Upload-S3>tonyxu-io/Alfred-Workflow-Upload-S3</a></p><p>References:</p><ul><li><a href=http://xfyuan.github.io/2017/03/use-alfred-to-auto-upload-screenshot-to-qiniu-and-generate-the-markdown-image-url/>使用 Alfred workflow 上传截图到七牛并自动生成外链URL</a></li><li><a href=http://labmain.com/2016/04/06/A_Alfred_Workflow_upload_clipboard%27image_to_qiniu/>Alfred Workflow —— 上传剪贴板的图片到七牛</a></li></ul></div></div></div></div></div><section class="section has-background-light"><div class=container><div class=columns><div class="column has-text-centered"><p class="subtitle is-size-6-mobile">Subscribe to get update about programming, hacks, and other topics.</p><div id=mc_embed_signup><form action="https://tonyxu.us20.list-manage.com/subscribe/post?u=69c2a5fca21efd1ab71e96df7&id=c90267bbd1" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate><div id=mc_embed_signup_scroll><div class="field has-addons has-addons-centered"><div class=control><input type=email name=EMAIL class="input required email" id=mce-EMAIL placeholder="Email Address"></input></div><div class=control><button type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class="button is-info">Subscribe</button></div></div><div id=mce-responses class=clear><div class=response id=mce-error-response style=display:none></div><div class=response id=mce-success-response style=display:none></div></div><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_69c2a5fca21efd1ab71e96df7_c90267bbd1 tabindex=-1></input></div></div></form></div></div></div></section><section class=section><div class=container><div class=columns><div class="column is-8 is-offset-2 has-text-centered"><article><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"tonyxu-io"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div></div></section></main><footer><footer class=footer><div class=container><div class="content has-text-centered"><p class="text is-uppercase has-text-grey">© 2018-2021 Tony Xu</p><p class=text><a href=/about class="has-text-grey footer-link">About</a>
<a href=/friends class="has-text-grey footer-link">Friends</a>
<a href=/analytics class="has-text-grey footer-link">Analytics</a>
<a href=/index.xml class="has-text-grey footer-link">RSS</a></p></div></div></footer></footer></body></html>