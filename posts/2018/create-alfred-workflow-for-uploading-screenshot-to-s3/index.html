<!DOCTYPE html>
<html lang="en-US" class="has-navbar-fixed-top">

<head>
    <meta name="generator" content="Hugo 0.55.0-DEV" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Create Alfred workflow for uploading screenshot to S3 | Tony Xu Blog</title>

     
      
    
    
    
    
    

  <meta name="author" content="Tony Xu">

 
    <meta property="og:title" content="Create Alfred workflow for uploading screenshot to S3" />
<meta property="og:description" content="As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard.
Demo Overview  Use pngpaste to get image data from clipboard
 Write to a image file in /tmp folder
 Use boto3 to upload image file to AWS S3
  Implementation Now we have the idea to achieve the goal, let&rsquo;s do it in Alfred workflow and python script." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/" />
<meta property="article:published_time" content="2018-07-08T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-07-08T00:00:00&#43;00:00"/><meta property="og:site_name" content="Tony Xu Blog" />
 
    



 
    
     
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-577792-7', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
 
    
    
    <link rel="canonical" href="/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/">   <link rel="shortcut icon" type="image/png" href="profile-pic.png">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> 
    <link rel="stylesheet" href="/css/bulma.css"> 
</head>


<body>
    <header> <nav class="navbar is-fixed-top">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img src="/profile-pic.png" alt="logo">
      </a>
      <a class="navbar-item" href="/">
        Tony Xu Blog
      </a>
      <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div class="navbar-menu" id="navMenu">

      
      
      <div class="navbar-end">
        
        <a class="navbar-item" target="blank" href="https://github.com/tonyxu-io">
          <span class="icon">
            <i class="fa fa-github"></i>
          </span>
        </a>
        

        
        <a class="navbar-item" target="blank" href="https://www.linkedin.com/in/tonyxu93">
          <span class="icon">
            <i class="fa fa-linkedin"></i>
          </span>
        </a>
        
        <div class="navbar-item">
          
          
          <a itemprop="url" class="navbar-item "
            href="/about"><span itemprop="name">About</span></a>
          
          <a itemprop="url" class="navbar-item "
            href="/friends/"><span itemprop="name">Friends</span></a>
          
          <a itemprop="url" class="navbar-item  is-active"
            href="/posts/"><span itemprop="name">Posts</span></a>
          
        </div>
        
        <div class="navbar-item">
          <div class="field">
            <div class="control has-icons-left">
              <div class="select is-rounded  is-small">
                <select size="1" name="links" onchange="window.location.href=this.value;">
                  <option selected disabled>Language</option>
                  
                  <option value="/zh/posts/2018/create-alfred-workflow-for-uploading-screenshot-to-s3/">中文</option>
                  
                </select>
              </div>
              <div class="icon is-small is-left">
                <i class="fa fa-globe"></i>
              </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>

</nav> </header>
    <main>

<div class="section">
  <div class="container" itemscope itemtype="http://schema.org/BlogPosting">
    
<meta itemprop="name" content="Create Alfred workflow for uploading screenshot to S3">
<meta itemprop="description" content="As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard.
Demo Overview  Use pngpaste to get image data from clipboard
 Write to a image file in /tmp folder
 Use boto3 to upload image file to AWS S3
  Implementation Now we have the idea to achieve the goal, let&rsquo;s do it in Alfred workflow and python script.">


<meta itemprop="datePublished" content="2018-07-08T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-07-08T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="543">



<meta itemprop="keywords" content="" />

    <div class="columns">
      <div class="column is-8 is-offset-2">
        <p class="title">Create Alfred workflow for uploading screenshot to S3</p>
        <p class="text">
  
  <span>Sun, Jul 8, 2018</span>
  
</p>
        <hr />
        <div class="content">
          

<p>As Markdown markup language gets more and more popular, most people have a need to quickly generate a public url for screenshot/image in clipboard. Today I created an Alfred workflow that helps you upload images/screenshot in clipboard.</p>

<h2 id="demo">Demo</h2>

<p><img src="./2018-07-08+21_33_30.gif" alt="2018-07-08+21_33_30.gif" /></p>

<h2 id="overview">Overview</h2>

<ol>
<li>Use <code>pngpaste</code> to get image data from clipboard<br /></li>
<li>Write to a image file in <code>/tmp</code> folder<br /></li>
<li>Use <code>boto3</code> to upload image file to AWS S3<br />
<br /></li>
</ol>

<h2 id="implementation">Implementation</h2>

<p>Now we have the idea to achieve the goal, let&rsquo;s do it in Alfred workflow and python script.</p>

<h3 id="create-alfred-workflow">Create Alfred workflow</h3>

<p>Create <code>Blank Workflow</code> and give it a name</p>

<p>Right click in background and select <code>Inputs -&gt; Keyword</code></p>

<p><img src="./2018_07_08_20_56_57.png" alt="2018_07_08_20_56_57.png" /></p>

<p>Give it a keyword which you will be typing to trigger the workflow</p>

<p><img src="./2018_07_08_20_50_57.png" alt="2018_07_08_20_50_57.png" /></p>

<p>Right click in background and select <code>Actions -&gt; Run Script</code></p>

<p>Let&rsquo;s make it use Python to run a script</p>

<p><img src="./2018_07_08_20_58_41.png" alt="2018_07_08_20_58_41.png" /></p>

<p>Click on the icon on the left of <code>Cancel</code> button to open workflow folder</p>

<p>Create a script file (Make sure the file name is the same as the <code>Run Script</code> action uses) and edit like below</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic">#!/usr/bin/python</span>
<span style="color:#8f5902;font-style:italic"># -*- coding: utf-8 -*-</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">__future__</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">print_function</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">datetime</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">os</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">sys</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">atexit</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">imghdr</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">subprocess</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">call</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">os.path</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">expanduser</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">exists</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">basename</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">getsize</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">workflow</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Workflow</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">capture</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#000">file_name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">datetime</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">datetime</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">now</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strftime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;%Y_%m_</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">_%H_%M_%S.png&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">file_path</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;/tmp&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">file_name</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">atexit</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">register</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">remove</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exists</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">file_path</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">save</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">call</span><span style="color:#000;font-weight:bold">([</span><span style="color:#4e9a06">&#39;./pngpaste&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">file_path</span><span style="color:#000;font-weight:bold">])</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">save</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#8f5902;font-style:italic"># Quit job if no image found in clipboard</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#4e9a06">&#34;No image found in clipboard&#34;</span>
        <span style="color:#000">sys</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#204a87">exit</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">file_path</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">file_name</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">wf</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">boto3</span>
    <span style="color:#000">file_path</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">file_name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">capture</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">bucket_name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getenv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;bucket_name&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">s3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">boto3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">client</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#4e9a06">&#39;s3&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">aws_access_key_id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getenv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;access_key&#39;</span><span style="color:#000;font-weight:bold">),</span>
        <span style="color:#000">aws_secret_access_key</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getenv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;secret_key&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">s3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">upload_file</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">file_path</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">bucket_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">file_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ExtraArgs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;ContentType&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;image/png&#34;</span><span style="color:#000;font-weight:bold">})</span>
    <span style="color:#000">output</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">/</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getenv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;bucket_uri&#39;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">file_name</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">end</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">wf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Workflow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">libraries</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;./lib&#39;</span><span style="color:#000;font-weight:bold">])</span>
    <span style="color:#000">sys</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#204a87">exit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">wf</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">main</span><span style="color:#000;font-weight:bold">))</span></code></pre></div>
<p>This script will return the image public url and let&rsquo;s copy it to clipboard and push a notification.</p>

<p>Right click on the background and select <code>Outputs –&gt; Copy to Clipboard</code></p>

<p><img src="./2018_07_08_21_06_32.png" alt="2018_07_08_21_06_32.png" /></p>

<p>Right click on the background and select <code>Outputs –&gt; Post Notification</code></p>

<p><img src="./2018_07_08_21_06_54.png" alt="2018_07_08_21_06_54.png)" /></p>

<p>Now let&rsquo;s connect those boxes like below:</p>

<p><img src="./2018_07_08_21_07_52.png" alt="2018_07_08_21_07_52.png" /></p>

<h3 id="include-libraries">Include libraries</h3>

<p>In the scripts, we used below libraries and need to be included in the workflow to make sure they can be run without issue</p>

<ul>
<li><a href="http://alfredworkflow.readthedocs.io/en/latest/installation.html">Workflow</a><br /></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html">awscli</a><br /></li>
<li><a href="https://boto3.readthedocs.io/en/latest/guide/quickstart.html#installation">boto3</a><br /></li>
<li><a href="https://github.com/jcsalterego/pngpaste">pngpaste</a><br />
<br /></li>
</ul>

<p>Install above libraries like below:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pip install --target<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/workflow Alfred-Workflow
pip install --target<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/workflow/lib awscli
pip install --target<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/workflow/lib boto3
brew install pngpaste</code></pre></div>
<p>Please note that pngpaste is a command line tool and you should copy the binary file to <code>/path/to/workflow</code>.</p>

<h3 id="add-environment-variables">Add environment variables</h3>

<p>In the script, we used below variables that we want to make it configurable instead of hard coded:</p>

<ul>
<li><p>access_key: S3 access key</p></li>

<li><p>secret_key: S3 access secret</p></li>

<li><p>bucket_name: S3 bucket name. e.g. <code>my-bucket-name</code></p></li>

<li><p>bucket_uri: S3 bucket URI without trailing slash. e.g. <code>https://s3-us-west-1.amazonaws.com/my-bucket-name</code></p></li>
</ul>

<p>Add and config above environment variables into workflow environment variables settings like below</p>

<p><img src="./2018_07_10_20_55_19.png" alt="2018_07_10_20_55_19.png" /></p>

<p>Follow instructions <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_CreateAccessKey">here</a> to create access key and secret if you don&rsquo;t have it already</p>

<p>Make sure the user can read/write to S3 bucket.</p>

<h2 id="complete">Complete</h2>

<p>Congratulations You made it! Give it a try!</p>

<h2 id="follow-up">Follow-up</h2>

<p>Now you may think of adding support for the workflow to be able to upload any image from local. As you are getting familiar with Alfred workflow development, feel free to give it a try!</p>

<p>Download in Github:</p>

<p><a href="https://github.com/tonyxu-io/Alfred-Workflow-Upload-S3">tonyxu-io/Alfred-Workflow-Upload-S3</a></p>

<p>References:</p>

<ul>
<li><a href="http://xfyuan.github.io/2017/03/use-alfred-to-auto-upload-screenshot-to-qiniu-and-generate-the-markdown-image-url/">使用 Alfred workflow 上传截图到七牛并自动生成外链URL</a><br /></li>
<li><a href="http://labmain.com/2016/04/06/A_Alfred_Workflow_upload_clipboard%27image_to_qiniu/">Alfred Workflow —— 上传剪贴板的图片到七牛</a><br /></li>
</ul>

        </div>
        
        <article>
          <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'tonyxu-io';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>
        
      </div>
    </div>
  </div>
</div>
</main>
    <footer>
<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
        © 2019 Tony Xu
      </p>
    </div>
  </div>
</footer>
</footer>

    <script async type="text/javascript" src="/js/bulma.js"></script>
</body>

</html>